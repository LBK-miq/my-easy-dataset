/**
 * 细粒度问题生成 Prompt
 * @param {*} text 待处理文本
 * @param {*} abstract 文本摘要
 */
function getDetailQuestionPrompt({
    text,
    number = Math.floor(text.length / 300),
    language = '中文',
    globalPrompt = '',
    questionPrompt = ''
  }) {
    if (globalPrompt) {
      globalPrompt = `在后续的任务中，你务必遵循这样的规则：${globalPrompt}`;
    }
    if (questionPrompt) {
      questionPrompt = `- 在生成问题时，你务必遵循这样的规则：${questionPrompt}`;
    }
    return `
      # 角色使命
      你是一位专业的文本分析专家，擅长从复杂文本中提取关键信息并生成可用于模型微调的结构化数据（仅生成问题）。
      ${globalPrompt}
  
      ## 核心任务
      根据用户提供的文本（长度：${text.length} 字），以其中的摘要(Abstract)为依据，参考正文对每一条摘要生成不少于1个高质量问题。
  
      ## 约束条件（重要！）
      - 必须基于文本内容直接生成
      - 问题应明确指向某个具体细节（如概念细节、具体规定等）
      - 需覆盖文本的不同方面
      - 禁止生成假设性、重复或相似问题
  
      ## 处理流程
      1. 【文本解析】分段处理内容，识别关键实体和核心概念
      2. 【问题生成】基于文本摘要中给出的提问知识点及参考文本生成问题
      3. 【质量检查】确保：
         - 问题答案可在原文中找到依据
         - 问题内容指向文本的细节具体描述
         - 无格式错误
      
      ## 输出格式
      - JSON 数组格式必须正确
      - 字段名使用英文双引号
      - 输出的 JSON 数组必须严格符合以下结构：
      \`\`\`json
      ["问题1", "问题2", "..."]
      \`\`\`
  
      ## 输出示例
      \`\`\`json
      [ "人工智能伦理框架应包含哪些核心要素？","民法典对个人数据保护有哪些新规定？"]
       \`\`\`
  
      ## 待处理文本（含文本摘要(Abstract)与正文）
      ${text}
  
      ## 限制
      - 必须按照规定的 JSON 格式输出，不要输出任何其他不相关内容
      - 对每条文本摘要生成不少于1个高质量问题
      - 问题不要和材料本身相关，例如禁止出现作者、章节、目录等相关问题
      - 问题不得包含【报告、文章、文献、表格】中提到的这种话术，必须是一个自然的问题
      ${questionPrompt}
      `;
  };

/**
 * 粗粒度问题生成 Prompt
 * @param {*} text 待处理文本
 * @param {*} number 问题数量
 */
function getGeneralQuestionPrompt({
    text,
    number = Math.floor(text.length / 300),
    language = '中文',
    globalPrompt = '',
    questionPrompt = ''
  }) {
    if (globalPrompt) {
      globalPrompt = `在后续的任务中，你务必遵循这样的规则：${globalPrompt}`;
    }
    if (questionPrompt) {
      questionPrompt = `- 在生成问题时，你务必遵循这样的规则：${questionPrompt}`;
    }
    return `
      # 角色使命
      你是一位专业的文本分析专家，擅长从复杂文本中提取关键信息并生成可用于模型微调的结构化数据（仅生成问题）。
      ${globalPrompt}
  
      ## 核心任务
      根据用户提供的文本（长度：${text.length} 字），生成不少于 ${number} 个具有概括总结性质的高质量问题。
  
      ## 约束条件（重要！）
      - 必须基于文本内容直接生成，即问题应存在以文本为依据的答案
      - 忽略文本中的知识点摘要(Abstract)部分，重点关注文本正文
      - 问题应关注文本的整体概括、知识框架、上下文理解，提出粗粒度、总结性的问题，不直接询问某一具体知识点
      - 需覆盖文本的不同方面
      - 考虑文本的实际性质，允许以与文本内容相关的场景信息（如政策文本的适用场景等）为背景提问
      - 禁止生成重复或相似问题
  
      ## 处理流程
      1. 【文本解析】分段处理内容，识别关键实体和核心概念
      2. 【问题生成】基于信息密度、知识框架等选择最佳提问点
      3. 【质量检查】确保：
         - 问题答案可在原文中找到依据
         - 问题内容无明确知识点细节指向，但符合文本知识框架及其内涵
         - 无格式错误
      
      ## 输出格式
      - JSON 数组格式必须正确
      - 字段名使用英文双引号
      - 输出的 JSON 数组必须严格符合以下结构：
      \`\`\`json
      ["问题1", "问题2", "..."]
      \`\`\`
  
      ## 输出示例
      \`\`\`json
      [ "学生选修课程应在选课平台上进行哪些操作？","民法典对个人数据保护有哪些新规定？"]
       \`\`\`
  
      ## 待处理文本
      ${text}
  
      ## 限制
      - 必须按照规定的 JSON 格式输出，不要输出任何其他不相关内容
      - 生成不少于${number}个高质量问题
      - 问题不要和材料本身相关，例如禁止出现作者、章节、目录等相关问题
      - 问题不得包含【报告、文章、文献、表格】中提到的这种话术，必须是一个自然的问题
      ${questionPrompt}
      `;
  };

module.exports = {
    getDetailQuestionPrompt,
    getGeneralQuestionPrompt
}